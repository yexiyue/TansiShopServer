import{d as R,C as S,r as d,L as w,aT as A,ad as v,an as T,as as z,aq as E,B as X,c as V,b as t,w as s,F as y,aU as j,aX as G,o as _,f as x,ab as H,u as J,ao as N,_ as K}from"./index-2f0a72f8.js";import{U as O,P as Q}from"./index-4babe8f7.js";import{F as W}from"./index-a78db1ee.js";import{F as Y}from"./index-bc173c66.js";import{s as $}from"./function-call-dcdab3ee.js";const Z=R({__name:"ModifyClothe",setup(h){const k=J(),C=j().params.id,a=S({name:"",articleNo:"",banners:[],fabric:"",price:0,category:"",frontImg:[],backImg:[],colorCount:[]}),c=d([]),p=d([]),i=d([]);w(async()=>{const l=(await A(C)).data;a.name=l.name,a.articleNo=l.articleNo,a.banners=l.banners.map(e=>e.imgUrl),a.fabric=l.fabric,a.price=l.price,a.category=l.category,a.frontImg=[l.frontImg],a.backImg=[l.backImg],a.colorCount=l.colorCount,c.value=l.banners.map(e=>({url:`${v}${e.imgUrl}`})),p.value=[{url:`${v}${l.frontImg}`}],i.value=[{url:`${v}${l.backImg}`}]});const F=()=>{k.back()},f=async(l,e)=>{if(l instanceof Array)for(let r of l){r.status="uploading";const n=await N(r.file);n.status===201&&(r.status="done",e.push(n.data))}else{l.status="uploading";const r=await N(l.file);r.status===201&&(l.status="done",e.push(r.data))}},b=(l,e)=>{e.splice(l,1)},L=async l=>{const e={...a,backImg:a.backImg[0],frontImg:a.frontImg[0],price:+a.price},r=await G(C,e);console.log(r),r.status!==200?$({type:"danger",message:"修改失败",lockScroll:!0}):($({type:"success",message:"修改成功",lockScroll:!0}),k.back(),a.name="",a.articleNo="",a.banners=[],a.fabric="",a.price=0,a.category="",a.frontImg=[],a.backImg=[],a.colorCount=[],c.value=[],p.value=[],i.value=[])},m=d(!1),I=d([]);w(async()=>{const l=await T();I.value.push(...l.data.map(e=>({text:e.value,value:e.value})))});const B=({selectedOptions:l})=>{var e;a.category=(e=l[0])==null?void 0:e.text,m.value=!1},q=()=>{a.colorCount.push({color:"黑色",count:100})};return(l,e)=>{const r=z,n=W,g=O,D=Q,M=E,U=X,P=Y;return _(),V(y,null,[t(r,{fixed:"",placeholder:"",title:"编辑商品","left-text":"返回","left-arrow":"",onClickLeft:F}),t(P,{class:"container",onSubmit:L},{default:s(()=>[t(n,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.name=o),name:"name",label:"名称",placeholder:"名称",rules:[{required:!0,message:"请填写名称"}]},null,8,["modelValue"]),t(n,{modelValue:a.articleNo,"onUpdate:modelValue":e[1]||(e[1]=o=>a.articleNo=o),name:"articleNo",label:"货号",placeholder:"#001"},null,8,["modelValue"]),t(n,{name:"uploader",label:"主轮播图(最多5张)"},{input:s(()=>[t(g,{onDelete:e[2]||(e[2]=(o,{index:u})=>b(u,a.banners)),modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),"max-count":5,"after-read":o=>{f(o,a.banners)},multiple:""},null,8,["modelValue","after-read"])]),_:1}),t(n,{modelValue:a.fabric,"onUpdate:modelValue":e[4]||(e[4]=o=>a.fabric=o),name:"fabric",label:"面料",placeholder:"丝光棉"},null,8,["modelValue"]),t(n,{modelValue:a.price,"onUpdate:modelValue":e[5]||(e[5]=o=>a.price=o),type:"number",name:"price",label:"价格",placeholder:"价格"},null,8,["modelValue"]),t(n,{modelValue:a.category,"onUpdate:modelValue":e[6]||(e[6]=o=>a.category=o),onClick:e[7]||(e[7]=o=>m.value=!0),readonly:"","is-link":"",rules:[{required:!0,message:"请选择分类"}],name:"category",label:"分类",placeholder:"连衣裙"},null,8,["modelValue"]),t(M,{show:m.value,"onUpdate:show":e[9]||(e[9]=o=>m.value=o),position:"bottom"},{default:s(()=>[t(D,{columns:I.value,onConfirm:B,onCancel:e[8]||(e[8]=o=>m.value=!1)},null,8,["columns"])]),_:1},8,["show"]),t(n,{name:"uploader2",label:"货款前图"},{input:s(()=>[t(g,{onDelete:e[10]||(e[10]=(o,{index:u})=>b(u,a.frontImg)),modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=o=>p.value=o),"max-count":1,"after-read":o=>{f(o,a.frontImg)},multiple:""},null,8,["modelValue","after-read"])]),_:1}),t(n,{name:"uploader2",label:"货款后图"},{input:s(()=>[t(g,{onDelete:e[12]||(e[12]=(o,{index:u})=>b(u,a.backImg)),modelValue:i.value,"onUpdate:modelValue":e[13]||(e[13]=o=>i.value=o),"max-count":1,"after-read":o=>{f(o,a.backImg)},multiple:""},null,8,["modelValue","after-read"])]),_:1}),t(U,{onClick:q,square:"",type:"primary",size:"small"},{default:s(()=>[x("添加颜色数量")]),_:1}),(_(!0),V(y,null,H(a.colorCount,o=>(_(),V(y,null,[t(n,{modelValue:o.color,"onUpdate:modelValue":u=>o.color=u,name:"color",label:"颜色",placeholder:"砖红色"},null,8,["modelValue","onUpdate:modelValue"]),t(n,{modelValue:o.count,"onUpdate:modelValue":u=>o.count=u,type:"number",name:"count",label:"数量",placeholder:"100"},null,8,["modelValue","onUpdate:modelValue"])],64))),256)),t(U,{class:"my-button",round:"",type:"primary",block:"","native-type":"submit"},{default:s(()=>[x(" 修改新商品 ")]),_:1})]),_:1})],64)}}});const re=K(Z,[["__scopeId","data-v-86f863c5"]]);export{re as default};
