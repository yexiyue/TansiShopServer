import{g as j,Q as re,q as D,av as W,d as R,x as G,aw as H,ax as L,r as E,a8 as Se,D as ue,J as ne,ay as De,N as de,b as c,S as fe,az as ae,Z as ve,al as Ee,ak as Be,P as _,t as $,y as z,G as B,aA as Fe,K as J,a0 as me,aB as A,m as ge,aC as Q,M as Ve,aD as Ne,i as he,V as be,p as Me,T as Y,I as Ae,aE as we,aF as Re,aG as Ue,$ as He,aH as $e,aI as ze,n as _e,C as Le}from"./index-2f0a72f8.js";import{a as je}from"./function-call-dcdab3ee.js";const[Ke,S,le]=j("picker"),ye=e=>e.find(n=>!n.disabled)||e[0];function Ge(e,n){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(n.children in t)return"cascade"}return"default"}function ee(e,n){n=W(n,0,e.length);for(let t=n;t<e.length;t++)if(!e[t].disabled)return t;for(let t=n-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const oe=(e,n,t)=>n!==void 0&&!!e.find(s=>s[t.value]===n);function te(e,n,t){const s=e.findIndex(v=>v[t.value]===n),i=ee(e,s);return e[i]}function Ye(e,n,t){const s=[];let i={[n.children]:e},v=0;for(;i&&i[n.children];){const w=i[n.children],x=t.value[v];if(i=re(x)?te(w,x,n):void 0,!i&&w.length){const f=ye(w)[n.value];i=te(w,f,n)}v++,s.push(w)}return s}function qe(e){const{transform:n}=window.getComputedStyle(e),t=n.slice(7,n.length-1).split(", ")[5];return Number(t)}function Je(e){return D({text:"text",value:"value",children:"children"},e)}const ie=200,ce=300,Qe=15,[xe,X]=j("picker-column"),pe=Symbol(xe);var Xe=R({name:xe,props:{value:G,fields:H(Object),options:L(),readonly:Boolean,allowHtml:Boolean,optionHeight:H(Number),swipeDuration:H(G),visibleOptionNum:H(G)},emits:["change","clickOption"],setup(e,{emit:n,slots:t}){let s,i,v,w,x;const f=E(),u=E(),d=E(0),m=E(0),b=Se(),O=()=>e.options.length,F=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,I=r=>{const y=ee(e.options,r),a=-y*e.optionHeight,o=()=>{const h=e.options[y][e.fields.value];h!==e.value&&n("change",h)};s&&a!==d.value?x=o:o(),d.value=a},P=()=>e.readonly||!e.options.length,V=r=>{s||P()||(x=null,m.value=ie,I(r),n("clickOption",e.options[r]))},N=r=>W(Math.round(-r/e.optionHeight),0,O()-1),M=(r,y)=>{const a=Math.abs(r/y);r=d.value+a/.003*(r<0?-1:1);const o=N(r);m.value=+e.swipeDuration,I(o)},l=()=>{s=!1,m.value=0,x&&(x(),x=null)},g=r=>{if(!P()){if(b.start(r),s){const y=qe(u.value);d.value=Math.min(0,y-F())}m.value=0,i=d.value,v=Date.now(),w=i,x=null}},T=r=>{if(P())return;b.move(r),b.isVertical()&&(s=!0,fe(r,!0)),d.value=W(i+b.deltaY.value,-(O()*e.optionHeight),e.optionHeight);const y=Date.now();y-v>ce&&(v=y,w=d.value)},p=()=>{if(P())return;const r=d.value-w,y=Date.now()-v;if(y<ce&&Math.abs(r)>Qe){M(r,y);return}const o=N(d.value);m.value=ie,I(o),setTimeout(()=>{s=!1},0)},k=()=>{const r={height:`${e.optionHeight}px`};return e.options.map((y,a)=>{const o=y[e.fields.text],{disabled:h}=y,K=y[e.fields.value],U={role:"button",style:r,tabindex:h?-1:0,class:[X("item",{disabled:h,selected:K===e.value}),y.className],onClick:()=>V(a)},Ie={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:o};return c("li",U,[t.option?t.option(y):c("div",Ie,null)])})};return ue(pe),ne({stopMomentum:l}),De(()=>{const r=e.options.findIndex(o=>o[e.fields.value]===e.value),a=-ee(e.options,r)*e.optionHeight;d.value=a}),de("touchmove",T,{target:f}),()=>c("div",{ref:f,class:X(),onTouchstartPassive:g,onTouchend:p,onTouchcancel:p},[c("ul",{ref:u,style:{transform:`translate3d(0, ${d.value+F()}px, 0)`,transitionDuration:`${m.value}ms`,transitionProperty:m.value?"all":"none"},class:X("wrapper"),onTransitionend:l},[k()])])}});const[Ze]=j("picker-toolbar"),q={title:String,cancelButtonText:String,confirmButtonText:String},We=["cancel","confirm","title","toolbar"],et=Object.keys(q);var Ce=R({name:Ze,props:q,emits:["confirm","cancel"],setup(e,{emit:n,slots:t}){const s=()=>{if(t.title)return t.title();if(e.title)return c("div",{class:[S("title"),"van-ellipsis"]},[e.title])},i=()=>n("cancel"),v=()=>n("confirm"),w=()=>{const f=e.cancelButtonText||le("cancel");return c("button",{type:"button",class:[S("cancel"),ae],onClick:i},[t.cancel?t.cancel():f])},x=()=>{const f=e.confirmButtonText||le("confirm");return c("button",{type:"button",class:[S("confirm"),ae],onClick:v},[t.confirm?t.confirm():f])};return()=>c("div",{class:S("toolbar")},[t.toolbar?t.toolbar():[w(),s(),x()]])}});const[Te,Z]=j("picker-group"),ke=Symbol(Te),tt=D({tabs:L(),nextStepText:String},q);R({name:Te,props:tt,emits:["confirm","cancel"],setup(e,{emit:n,slots:t}){const s=E(0),{children:i,linkChildren:v}=ve(ke);v();const w=()=>s.value<e.tabs.length-1&&e.nextStepText,x=()=>{w()?s.value++:n("confirm",i.map(u=>u.confirm()))},f=()=>n("cancel");return()=>{var u;const d=(u=t.default)==null?void 0:u.call(t),m=w()?e.nextStepText:e.confirmButtonText;return c("div",{class:Z()},[c(Ce,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:m,onConfirm:x,onCancel:f},null),c(Ee,{active:s.value,"onUpdate:active":b=>s.value=b,class:Z("tabs"),shrink:!0,animated:!0},{default:()=>[e.tabs.map((b,O)=>c(Be,{title:b,titleClass:Z("tab-title")},{default:()=>[d==null?void 0:d[O]]}))]})])}}});const nt=D({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:_(44),showToolbar:$,swipeDuration:_(1e3),visibleOptionNum:_(6)},q),at=D({},nt,{columns:L(),modelValue:L(),toolbarPosition:z("top"),columnsFieldNames:Object});var lt=R({name:Ke,props:at,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:n,slots:t}){const s=E(),i=E(e.modelValue.slice(0)),{parent:v}=ue(ke),{children:w,linkChildren:x}=ve(pe);x();const f=B(()=>Je(e.columnsFieldNames)),u=B(()=>Fe(e.optionHeight)),d=B(()=>Ge(e.columns,f.value)),m=B(()=>{const{columns:a}=e;switch(d.value){case"multiple":return a;case"cascade":return Ye(a,f.value,i);default:return[a]}}),b=B(()=>m.value.some(a=>a.length)),O=B(()=>m.value.map((a,o)=>te(a,i.value[o],f.value))),F=B(()=>m.value.map((a,o)=>a.findIndex(h=>h[f.value.value]===i.value[o]))),I=(a,o)=>{if(i.value[a]!==o){const h=i.value.slice(0);h[a]=o,i.value=h}},P=()=>({selectedValues:i.value.slice(0),selectedOptions:O.value,selectedIndexes:F.value}),V=(a,o)=>{I(o,a),d.value==="cascade"&&i.value.forEach((h,K)=>{const U=m.value[K];oe(U,h,f.value)||I(K,U.length?U[0][f.value.value]:void 0)}),n("change",D({columnIndex:o},P()))},N=(a,o)=>n("clickOption",D({columnIndex:o,currentOption:a},P())),M=()=>{w.forEach(o=>o.stopMomentum());const a=P();return Ve(()=>{n("confirm",a)}),a},l=()=>n("cancel",P()),g=()=>m.value.map((a,o)=>c(Xe,{value:i.value[o],fields:f.value,options:a,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:u.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:h=>V(h,o),onClickOption:h=>N(h,o)},{option:t.option})),T=a=>{if(b.value){const o={height:`${u.value}px`},h={backgroundSize:`100% ${(a-u.value)/2}px`};return[c("div",{class:S("mask"),style:h},null),c("div",{class:[Ne,S("frame")],style:o},null)]}},p=()=>{const a=u.value*+e.visibleOptionNum,o={height:`${a}px`};return c("div",{ref:s,class:S("columns"),style:o},[g(),T(a)])},k=()=>{if(e.showToolbar&&!v)return c(Ce,ge(A(e,et),{onConfirm:M,onCancel:l}),A(t,We))};J(m,a=>{a.forEach((o,h)=>{o.length&&!oe(o,i.value[h],f.value)&&I(h,ye(o)[f.value.value])})},{immediate:!0});let r;return J(()=>e.modelValue,a=>{!Q(a,i.value)&&!Q(a,r)&&(i.value=a.slice(0))},{deep:!0}),J(i,a=>{Q(a,e.modelValue)||(r=a.slice(0),n("update:modelValue",r))},{immediate:!0}),de("touchmove",fe,{target:s}),ne({confirm:M,getSelectedOptions:()=>O.value}),()=>{var a,o;return c("div",{class:S()},[e.toolbarPosition==="top"?k():null,e.loading?c(me,{class:S("loading")},null):null,(a=t["columns-top"])==null?void 0:a.call(t),p(),(o=t["columns-bottom"])==null?void 0:o.call(t),e.toolbarPosition==="bottom"?k():null])}}});const gt=he(lt),[ot,C,it]=j("uploader");function se(e,n){return new Promise(t=>{if(n==="file"){t();return}const s=new FileReader;s.onload=i=>{t(i.target.result)},n==="dataUrl"?s.readAsDataURL(e):n==="text"&&s.readAsText(e)})}function Oe(e,n){return be(e).some(t=>t.file?Me(n)?n(t.file):t.file.size>n:!1)}function ct(e,n){const t=[],s=[];return e.forEach(i=>{Oe(i,n)?s.push(i):t.push(i)}),{valid:t,invalid:s}}const st=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i,rt=e=>st.test(e);function Pe(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?rt(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var ut=R({props:{name:G,item:H(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:n,slots:t}){const s=()=>{const{status:u,message:d}=e.item;if(u==="uploading"||u==="failed"){const m=u==="failed"?c(Y,{name:"close",class:C("mask-icon")},null):c(me,{class:C("loading")},null),b=re(d)&&d!=="";return c("div",{class:C("mask")},[m,b&&c("div",{class:C("mask-message")},[d])])}},i=u=>{const{name:d,item:m,index:b,beforeDelete:O}=e;u.stopPropagation(),Re(O,{args:[m,{name:d,index:b}],done:()=>n("delete")})},v=()=>n("preview"),w=()=>{if(e.deletable&&e.item.status!=="uploading"){const u=t["preview-delete"];return c("div",{role:"button",class:C("preview-delete",{shadow:!u}),tabindex:0,"aria-label":it("delete"),onClick:i},[u?u():c(Y,{name:"cross",class:C("preview-delete-icon")},null)])}},x=()=>{if(t["preview-cover"]){const{index:u,item:d}=e;return c("div",{class:C("preview-cover")},[t["preview-cover"](D({index:u},d))])}},f=()=>{const{item:u,lazyLoad:d,imageFit:m,previewSize:b}=e;return Pe(u)?c(Ae,{fit:m,src:u.content||u.url,class:C("preview-image"),width:Array.isArray(b)?b[0]:b,height:Array.isArray(b)?b[1]:b,lazyLoad:d,onClick:v},{default:x}):c("div",{class:C("file"),style:we(e.previewSize)},[c(Y,{class:C("file-icon"),name:"description"},null),c("div",{class:[C("file-name"),"van-ellipsis"]},[u.file?u.file.name:u.url]),x()])};return()=>c("div",{class:C("preview")},[f(),s(),w()])}});const dt={name:_(""),accept:z("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:_(1/0),imageFit:z("cover"),resultType:z("dataUrl"),uploadIcon:z("photograph"),uploadText:String,deletable:$,afterRead:Function,showUpload:$,modelValue:L(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:$,previewOptions:Object,previewFullImage:$,maxSize:{type:[Number,String,Function],default:1/0}};var ft=R({name:ot,props:dt,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:n,slots:t}){const s=E(),i=[],v=(l=e.modelValue.length)=>({name:e.name,index:l}),w=()=>{s.value&&(s.value.value="")},x=l=>{if(w(),Oe(l,e.maxSize))if(Array.isArray(l)){const g=ct(l,e.maxSize);if(l=g.valid,n("oversize",g.invalid,v()),!l.length)return}else{n("oversize",l,v());return}l=Le(l),n("update:modelValue",[...e.modelValue,...be(l)]),e.afterRead&&e.afterRead(l,v())},f=l=>{const{maxCount:g,modelValue:T,resultType:p}=e;if(Array.isArray(l)){const k=+g-T.length;l.length>k&&(l=l.slice(0,k)),Promise.all(l.map(r=>se(r,p))).then(r=>{const y=l.map((a,o)=>{const h={file:a,status:"",message:""};return r[o]&&(h.content=r[o]),h});x(y)})}else se(l,p).then(k=>{const r={file:l,status:"",message:""};k&&(r.content=k),x(r)})},u=l=>{const{files:g}=l.target;if(e.disabled||!g||!g.length)return;const T=g.length===1?g[0]:[].slice.call(g);if(e.beforeRead){const p=e.beforeRead(T,v());if(!p){w();return}if(_e(p)){p.then(k=>{f(k||T)}).catch(w);return}}f(T)};let d;const m=()=>n("closePreview"),b=l=>{if(e.previewFullImage){const g=e.modelValue.filter(Pe),T=g.map(p=>(p.file&&!p.url&&p.status!=="failed"&&(p.url=URL.createObjectURL(p.file),i.push(p.url)),p.url)).filter(Boolean);d=je(D({images:T,startPosition:g.indexOf(l),onClose:m},e.previewOptions))}},O=()=>{d&&d.close()},F=(l,g)=>{const T=e.modelValue.slice(0);T.splice(g,1),n("update:modelValue",T),n("delete",l,v(g))},I=(l,g)=>{const T=["imageFit","deletable","previewSize","beforeDelete"],p=D(A(e,T),A(l,T,!0));return c(ut,ge({item:l,index:g,onClick:()=>n("clickPreview",l,v(g)),onDelete:()=>F(l,g),onPreview:()=>b(l)},A(e,["name","lazyLoad"]),p),A(t,["preview-cover","preview-delete"]))},P=()=>{if(e.previewImage)return e.modelValue.map(I)},V=l=>n("clickUpload",l),N=()=>{if(e.modelValue.length>=e.maxCount)return;const l=e.readonly?null:c("input",{ref:s,type:"file",class:C("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:u},null);return t.default?c("div",{class:C("input-wrapper"),onClick:V},[t.default(),l]):$e(c("div",{class:C("upload",{readonly:e.readonly}),style:we(e.previewSize),onClick:V},[c(Y,{name:e.uploadIcon,class:C("upload-icon")},null),e.uploadText&&c("span",{class:C("upload-text")},[e.uploadText]),l]),[[ze,e.showUpload]])},M=()=>{s.value&&!e.disabled&&s.value.click()};return Ue(()=>{i.forEach(l=>URL.revokeObjectURL(l))}),ne({chooseFile:M,closeImagePreview:O}),He(()=>e.modelValue),()=>c("div",{class:C()},[c("div",{class:C("wrapper",{disabled:e.disabled})},[P(),N()])])}});const ht=he(ft);export{gt as P,ht as U};
